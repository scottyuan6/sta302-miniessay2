---
title: "Untitled"
format: html
editor: visual
---

### **1.1 Simulate**

```{r}
#### Workspace setup ####
install.packages("opendatatoronto")
install.packages("knitr")
install.packages("janitor")
install.packages("lubridate")
install.packages("tidyverse")
library(knitr)
library(janitor)
library(lubridate)
library(opendatatoronto)
library(tidyverse)
```

```{r}
#### Simulate ####
set.seed(853)

simulated_occupancy_data <-
  tibble(
    date = rep(x = as.Date("2023-01-01") + c(0:364), times = 3),
    # Based on Eddelbuettel: https://stackoverflow.com/a/21502386
    shelter = c(
      rep(x = "Shelter 1", times = 365),
      rep(x = "Shelter 2", times = 365),
      rep(x = "Shelter 3", times = 365)
    ),
    location_city = sample(
      x = c("Toronto","North York","Etobicoke","Scarborough","Vaughan"),
      size = 365*3,
      replace = TRUE),
    number_occupied =
      rpois(
        n = 365 * 3,
        lambda = 30
      ) # Draw 1,095 times from the Poisson distribution
  )

head(simulated_occupancy_data)
```

### **1.2 Acquire**

```{r}
#### Acquire ####
toronto_shelters <-
  # Each package is associated with a unique id  found in the "For 
  # Developers" tab of the relevant page from Open Data Toronto
  # https://open.toronto.ca/dataset/daily-shelter-overnight-service-occupancy-capacity/
  list_package_resources("21c83b32-d5a8-4106-a54f-010dbe49f6f2") |>
  # Within that package, we are interested in the 2021 dataset
  filter(name == 
    "daily-shelter-overnight-service-occupancy-capacity-2023.csv") |>
  # Having reduced the dataset to one row we can get the resource
  get_resource()

write_csv(
  x = toronto_shelters,
  file = "toronto_shelters.csv"
)
toronto_shelters$LOCATION_CITY |>
  unique()

head(toronto_shelters)
```

```{r}
# List all column names in the dataframe
names(toronto_shelters)

```

```{r}
toronto_shelters_clean <- toronto_shelters %>%
  select(OCCUPANCY_DATE, LOCATION_CITY, OCCUPIED_BEDS)

head(toronto_shelters_clean)

```

### **1.3 Explore**

```{r}
write_csv(
  x = toronto_shelters_clean,
  file = "cleaned_toronto_shelters.csv"
)
```

```{r}
#### Explore ####
toronto_shelters_clean <-
  read_csv(
    "cleaned_toronto_shelters.csv",
    show_col_types = FALSE
  )
```

```{r}
toronto_shelters_clean <- toronto_shelters_clean %>%
  mutate(Month = floor_date(as.Date(OCCUPANCY_DATE), "month"))

monthly_beds <- toronto_shelters_clean %>%
  group_by(Month, LOCATION_CITY) %>%
  summarize(Total_Beds = sum(OCCUPIED_BEDS, na.rm = TRUE))

ggplot(monthly_beds, aes(x = Month, y = Total_Beds, fill = LOCATION_CITY)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(x = "Month", y = "Total Occupied Beds", fill = "City") +
  scale_x_date(date_breaks = "1 month", date_labels = "%b")

```

### **1.4 Share**

Toronto has a sizable homeless population. Because of the harsh winters, it is vital that shelters have ample space. We want to know how the use of shelters differs in the colder months against the warmer months, and we want to know which city has the most demand for shelters. We use statistics on Toronto shelter bed occupancy given by the City of Toronto. Each night at 4 a.m., a count of the occupied beds is made. We're curious in the overall amount of these across the month and city. We cleaned, tidied, and analyzed the dataset using R ([R Core Team 2023](https://tellingstorieswithdata.com/99-references.html#ref-citeR)) as well as the `tidyverse` ([Wickham 2017](https://tellingstorieswithdata.com/99-references.html#ref-Wickham2017)), `janitor` ([Firke 2023](https://tellingstorieswithdata.com/99-references.html#ref-janitor)), `opendatatoronto` ([Gelfand 2022](https://tellingstorieswithdata.com/99-references.html#ref-citeSharla)), `lubridate` ([Grolemund and Wickham 2011](https://tellingstorieswithdata.com/99-references.html#ref-GrolemundWickham2011)), and `knitr` ([Xie 2023](https://tellingstorieswithdata.com/99-references.html#ref-citeknitr)).

\
In analyzing the shelter bed occupancy data for Toronto, a clear pattern emerges: Toronto consistently shows the highest number of occupied shelter beds, with North York ranking second. As the months progress from January to December, there is a noticeable increase in shelter bed occupancy. This trend is congruent with the intuitive notion that colder months drive a higher demand for shelter services. The data underscores the importance of ensuring adequate shelter capacity to meet the rising needs as winter approaches, and it highlights the need for targeted strategies to manage the seasonal influx in shelter usage.
